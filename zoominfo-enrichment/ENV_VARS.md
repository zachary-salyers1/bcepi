# Environment Variables for Contact Enrichment

## Required Variables

### HubSpot
```
HUBSPOT_ACCESS_TOKEN=pat-na1-xxxxxxxx
```
Your HubSpot private app access token. Create one at:
Settings > Integrations > Private Apps

Required scopes:
- `crm.lists.read`
- `crm.objects.contacts.read`
- `crm.objects.contacts.write`

### ZoomInfo
```
ZOOMINFO_ACCESS_TOKEN=your-access-token
ZOOMINFO_REFRESH_TOKEN=your-refresh-token  # For token refresh
ZOOMINFO_CLIENT_ID=your-client-id
ZOOMINFO_CLIENT_SECRET=your-client-secret
ZOOMINFO_TOKEN_URL=https://okta-login.zoominfo.com/oauth2/default/v1/token
```

### Webhook Security
```
WEBHOOK_SECRET=your-random-secret-string
CRON_SECRET=your-vercel-cron-secret
```
The `CRON_SECRET` is auto-generated by Vercel for cron job authentication.

---

## Optional Variables

### Google Sheets Logging
To enable logging to Google Sheets, configure a service account:

```
GOOGLE_SPREADSHEET_ID=1Vrd7C-yOlT9ChKF52B3DsF8JVHM6nSH5N_WGwtoaB1M
GOOGLE_SHEET_NAME=Contact
GOOGLE_CLIENT_EMAIL=your-service-account@project.iam.gserviceaccount.com
GOOGLE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

**Setup steps:**
1. Create a Google Cloud project
2. Enable the Google Sheets API
3. Create a service account and download JSON key
4. Share your spreadsheet with the service account email
5. Copy the values from the JSON key

### Gemini (LinkedIn Validation)
```
GEMINI_API_KEY=your-gemini-api-key
GEMINI_MODEL=gemini-1.5-flash
```

Get your API key at: https://aistudio.google.com/apikey

---

## Configuration Variables

### HubSpot List
```
HUBSPOT_LIST_ID=151
```
The ID of the HubSpot list containing contacts to enrich.

### Rate Limiting
```
ENRICHMENT_BATCH_SIZE=10
ENRICHMENT_DELAY_MS=2000
```
- `ENRICHMENT_BATCH_SIZE`: Number of contacts to process per cron run (default: 10)
- `ENRICHMENT_DELAY_MS`: Delay between processing each contact in milliseconds (default: 2000)

### Pagination (Manual)
```
ENRICHMENT_CURSOR=
```
If not using Vercel KV, you can manually set the pagination cursor here.
The cursor value is logged after each run.

---

## Vercel KV (Optional)

For automatic pagination state persistence, enable Vercel KV:

1. Go to your Vercel project dashboard
2. Click "Storage" > "Create Database" > "KV"
3. Connect it to your project

The following environment variables are auto-added:
- `KV_URL`
- `KV_REST_API_URL`
- `KV_REST_API_TOKEN`
- `KV_REST_API_READ_ONLY_TOKEN`

---

## Cron Schedule

The cron job is configured in `vercel.json`:

```json
{
    "crons": [
        {
            "path": "/api/cron/enrich-contacts",
            "schedule": "0 */2 * * *"
        }
    ]
}
```

Current schedule: Every 2 hours at :00

Common schedules:
- `0 * * * *` - Every hour
- `0 */2 * * *` - Every 2 hours
- `0 */4 * * *` - Every 4 hours
- `0 9 * * *` - Daily at 9 AM UTC

---

## Manual Trigger

You can manually trigger the enrichment via:

```bash
curl -X POST https://your-project.vercel.app/api/cron/enrich-contacts \
  -H "x-webhook-secret: YOUR_WEBHOOK_SECRET"
```

---

## Testing Locally

1. Copy `.env.local.example` to `.env.local`
2. Fill in your credentials
3. Run `vercel dev` to start the local server
4. Trigger via: `curl -X POST http://localhost:3000/api/cron/enrich-contacts -H "x-webhook-secret: YOUR_SECRET"`
